---
title: "Inference Coursework"
output: html_notebook
---



```{r}
cov <- read.table("covid19.csv", sep=",",header=TRUE)
# cov$CMODateCount

for (K in 1:5) {
  par = integer(K+1)
  
  theta = optim(par=par, loglike, method="BFGS", y=cov$CMODateCount)
  
  n0 = theta$par[1]
  beta = theta$par[2:length(theta$par)]
  
  t = seq(-1, 1, length.out=length(cov$CMODateCount))
  
  with(cov,plot(1:41,cov$CMODateCount))
  
  
  e = exp(n0)
  
  for (i in seq_along(beta)) {
    e = e * exp(beta[i] * t^i)
  }
  
  
  
  lines(1:length(cov$CMODateCount), e, col="red")
  
  print(AIC(length(par), theta$value)) 
}

```




```{r}
N = function(t, n0, beta) {
  val = exp(n0)
  for (i in seq_along(beta)) {
    val = val * exp(beta[i]*t^i)
  }
  val
}

llik = function(y, theta) {
  n0 = theta[1]
  beta = theta[2:length(theta)]
  n = length(y)
  ll = 0
  t = seq(-1, 1, length.out=n)
  
  for (i in seq_along(t)) {
    ll = ll + y[i] * log(N(t[i], n0, beta)) - N(t[i], n0, beta)
  }
  -ll
}


loglike = function(y, theta) {
  n0 = theta[1]
  beta = theta[2:length(theta)]
  n = length(y)
  t = seq(-1, 1, length.out=n)
  ll <-sum(dpois(y, N(t, n0, beta), log=TRUE))
  -ll
}


K = 1

par = integer(K+1)



# theta = optim(par=par, loglike, method="BFGS", y=cov$CMODateCount)
# n0 = theta$par[1]
# beta = theta$par[2:length(theta$par)]
# 
# 
# n0
# beta
```
```{r}
AIC = function(num_par, val_ll) {
  2*val_ll + 2 * num_par
}

for(K in 1:5) {
  par = integer(K+1)

  theta = optim(par=par, loglike, method="BFGS", y=cov$CMODateCount)
  n0 = theta$par[1]
  beta = theta$par[2:length(theta$par)]
  
  print(AIC(length(par), theta$value))
}
```
```{r}
K0 = 3
par = integer(K0+1)
  
theta0 = optim(par=par, loglike, method="BFGS", y=cov$CMODateCount)


K1 = 4
par = integer(K1+1)
  
theta1 = optim(par=par, loglike, method="BFGS", y=cov$CMODateCount)


t = 2 * (theta0$value - theta1$value)

p <- pchisq(t,df=1)
1-p
```

```{r}
K1 = 4
par = integer(K1+1)
  
theta1 = optim(par=par, loglike, method="BFGS", y=cov$CMODateCount, hessian = TRUE)
covar = solve(theta1$hessian)

se <- sqrt(diag(covar))

ci.lower = rep(0,5)
ci.upper = rep(0,5)
for (i in 1:5) {
  ci.lower <- theta1$par[i]-1.96*se[i]
  ci.upper = theta1$par[i]+1.96*se[i]
}
sum(ci.lower)
sum(ci.upper)

```















